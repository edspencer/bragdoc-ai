---
phase: 06-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - docs/Payment Modes.md
  - .env.example
autonomous: false

must_haves:
  truths:
    - "docs/Payment Modes.md reflects credit-based access control or is removed"
    - ".env.example contains NEXT_PUBLIC_STRIPE_YEARLY_LINK and NEXT_PUBLIC_STRIPE_LIFETIME_LINK"
    - ".env.example does not contain old tier-based payment link variables"
    - "Old Stripe products are archived (not deleted) in Stripe Dashboard"
  artifacts:
    - path: ".env.example"
      provides: "Environment variable documentation for new payment links"
      contains: "STRIPE_YEARLY_LINK"
    - path: "docs/Payment Modes.md"
      provides: "Updated or removed - no longer references old tier system"
  key_links:
    - from: ".env.example"
      to: "Stripe Dashboard"
      via: "Payment link URLs"
      pattern: "buy.stripe.com"
---

<objective>
Archive old Stripe products and update documentation to reflect the new pricing model.

Purpose: Complete the cleanup by archiving legacy Stripe products (preserving payment history) and ensuring all documentation reflects the new credit-based system.

Output: Old Stripe products archived, documentation updated, environment variables verified.
</objective>

<execution_context>
@/Users/ed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cleanup/06-RESEARCH.md
@.planning/phases/06-cleanup/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update documentation files</name>
  <files>
    docs/Payment Modes.md
    .env.example
  </files>
  <action>
    1. **UPDATE or REMOVE `docs/Payment Modes.md`**:
       The current file documents the old tier-based feature gating system using `@bragdoc/config` payment-gates, which was removed in Plan 01.

       Option A (Recommended): REMOVE the file entirely since:
       - The tier-based gating system is replaced by credit-based access control
       - The credit system is implemented in `apps/web/lib/subscription-status.ts`
       - Feature gates are now based on `hasUnlimitedAccess()` and credit checks
       - The old documentation would be misleading

       Option B: REWRITE to document the new system:
       - Credit-based access control (10 free credits, 20 chat messages)
       - Paid users have unlimited access
       - Subscription status helpers in `apps/web/lib/subscription-status.ts`

       Choose Option A (remove) unless there's a strong reason to document payment modes separately.

    2. **VERIFY `.env.example`** has correct payment link variables:
       The file should already contain (from Phase 3):
       ```
       # Stripe Payment Links
       NEXT_PUBLIC_STRIPE_YEARLY_LINK="https://buy.stripe.com/xxx"   # $45/year subscription
       NEXT_PUBLIC_STRIPE_LIFETIME_LINK="https://buy.stripe.com/xxx" # $99 lifetime one-time
       ```

       Verify these exist and that OLD variables are NOT present:
       - Should NOT have: `NEXT_PUBLIC_BASIC_MONTHLY_PRICE_ID`
       - Should NOT have: `NEXT_PUBLIC_BASIC_YEARLY_PRICE_ID`
       - Should NOT have: `NEXT_PUBLIC_PRO_MONTHLY_PRICE_ID`
       - Should NOT have: `NEXT_PUBLIC_PRO_YEARLY_PRICE_ID`

       If old variables exist, remove them.
  </action>
  <verify>
    ```bash
    # Check if Payment Modes.md was removed or updated
    if [ -f "docs/Payment Modes.md" ]; then
      # If kept, verify it doesn't reference old system
      grep -q "basic\|pro\|payment-gates\|featureGates" "docs/Payment Modes.md" && echo "FAIL: old references remain" || echo "PASS: updated correctly"
    else
      echo "PASS: Payment Modes.md removed (expected)"
    fi

    # Verify .env.example has new variables
    grep -q "STRIPE_YEARLY_LINK" .env.example && echo "PASS: yearly link present" || echo "FAIL: yearly link missing"
    grep -q "STRIPE_LIFETIME_LINK" .env.example && echo "PASS: lifetime link present" || echo "FAIL: lifetime link missing"

    # Verify old variables are gone
    grep -q "BASIC_MONTHLY_PRICE_ID\|BASIC_YEARLY_PRICE_ID\|PRO_MONTHLY_PRICE_ID\|PRO_YEARLY_PRICE_ID" .env.example && echo "FAIL: old price IDs found" || echo "PASS: no old price IDs"
    ```
  </verify>
  <done>
    - docs/Payment Modes.md removed or updated to reflect new system
    - .env.example contains new payment link variables
    - .env.example does not contain old tier-based price ID variables
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Archive old Stripe products</name>
  <action>
    Archive (do NOT delete) the following legacy Stripe products via the Stripe Dashboard.

    **Why archive instead of delete:**
    - Archiving preserves all historical payment records
    - Archived products can be restored if needed
    - Deletion would break historical data references

    **Products to archive:**
    1. Basic Achiever monthly ($5/mo) - lookup_key: basic_monthly
    2. Basic Achiever yearly ($30/yr) - lookup_key: basic_yearly
    3. Pro Achiever monthly ($9/mo) - lookup_key: pro_monthly
    4. Pro Achiever yearly ($90/yr) - lookup_key: pro_yearly

    **Note:** If no old Stripe products exist in your Dashboard (they may have been created in a different Stripe account or never created), type "no products to archive" to proceed.
  </action>
  <instructions>
    1. Log into Stripe Dashboard at https://dashboard.stripe.com
    2. Navigate to **Products** in the left sidebar
    3. Find each legacy product listed above
    4. Click on the product to open details
    5. Click the "..." menu (or Archive button)
    6. Select **Archive** (NOT Delete)
    7. Confirm the archive action
    8. Repeat for all four products

    After archiving:
    - The products will show as "Archived" status
    - Old payment links will show "This product is no longer available"
    - Existing subscriptions (if any) are NOT affected
  </instructions>
  <resume-signal>Type "archived" when complete, or "no products to archive" if products don't exist</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Final verification and cleanup summary</name>
  <files>N/A - verification only</files>
  <action>
    Run final verification to confirm Phase 6 cleanup is complete:

    1. **Code verification:**
       - Confirm no legacy tier references in active code
       - Full build passes
       - Tests pass

    2. **Documentation verification:**
       - .env.example is correct
       - No outdated documentation references old tiers

    3. **Create cleanup summary:**
       - List all files removed
       - List all files updated
       - Note Stripe products archived
       - Confirm success criteria met

    4. **Check for lingering references:**
       Search for any remaining problematic patterns:
       - `basic_monthly`, `basic_yearly`, `pro_monthly`, `pro_yearly` in code
       - `$5/`, `$9/`, `$30/`, `$90/` pricing in non-planning files
       - Imports of deleted files
  </action>
  <verify>
    ```bash
    # Full build
    pnpm build

    # Full test
    pnpm test

    # Search for legacy patterns (excluding planning/docs/tests)
    echo "=== Checking for legacy tier patterns ==="
    grep -r "basic_monthly\|basic_yearly\|pro_monthly\|pro_yearly" \
      --include="*.ts" --include="*.tsx" \
      apps/ packages/ \
      | grep -v "\.planning\|schema\.ts\|\.test\.\|__tests__" \
      && echo "WARNING: legacy patterns found" || echo "PASS: no legacy patterns"

    echo ""
    echo "=== Checking for old pricing in marketing ==="
    grep -r "\$4\.99\|\$5/\|\$9/\|\$30/\|\$90/" \
      --include="*.tsx" \
      apps/marketing/ \
      && echo "WARNING: old pricing found" || echo "PASS: no old pricing"

    echo ""
    echo "=== Phase 6 Cleanup Complete ==="
    echo "Files removed:"
    echo "  - apps/web/lib/plans.ts"
    echo "  - packages/config/src/payment-gates.ts"
    echo "  - apps/web/scripts/create-stripe-products.ts"
    echo "  - docs/Payment Modes.md (if removed)"
    echo ""
    echo "Stripe products archived (via Dashboard):"
    echo "  - Basic Achiever monthly"
    echo "  - Basic Achiever yearly"
    echo "  - Pro Achiever monthly"
    echo "  - Pro Achiever yearly"
    ```
  </verify>
  <done>
    - pnpm build succeeds
    - pnpm test passes
    - No legacy tier references in active code
    - No old pricing references in marketing
    - Stripe products archived
    - Phase 6 complete
  </done>
</task>

</tasks>

<verification>
Phase 6 Plan 02 verification checklist:
- [ ] docs/Payment Modes.md removed or updated
- [ ] .env.example contains NEXT_PUBLIC_STRIPE_YEARLY_LINK
- [ ] .env.example contains NEXT_PUBLIC_STRIPE_LIFETIME_LINK
- [ ] .env.example does not contain old PRICE_ID variables
- [ ] Old Stripe products archived in Dashboard
- [ ] pnpm build succeeds
- [ ] pnpm test passes
- [ ] No legacy references in active code
</verification>

<success_criteria>
1. Documentation updated to reflect new pricing model
2. Old Stripe products archived (not deleted)
3. Environment variables correctly documented
4. Full build and tests pass
5. No legacy tier references remain in active code
</success_criteria>

<output>
After completion, create `.planning/phases/06-cleanup/06-02-SUMMARY.md`
</output>
