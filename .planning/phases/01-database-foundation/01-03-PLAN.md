---
phase: 01-database-foundation
plan: 03
type: execute
wave: 1
depends_on: ["01-01"]
files_modified:
  - apps/web/lib/better-auth/config.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "New free users receive freeCredits=10 upon account creation via Better Auth"
    - "New free users receive freeChatMessages=20 upon account creation via Better Auth"
    - "Better Auth returns freeCredits and freeChatMessages in user objects"
  artifacts:
    - path: "apps/web/lib/better-auth/config.ts"
      provides: "Better Auth user additionalFields including credit fields"
      contains: "freeCredits"
  key_links:
    - from: "apps/web/lib/better-auth/config.ts"
      to: "packages/database/src/schema.ts"
      via: "Better Auth additionalFields maps to database columns"
      pattern: "freeCredits.*defaultValue.*10"
---

<objective>
Register freeCredits and freeChatMessages fields with Better Auth so new users receive default values and the fields are included in user objects returned from authentication queries.

Purpose: Close verification gap where database schema has credit fields but Better Auth ORM layer doesn't know about them, causing type errors and missing field values in application code.

Output: Updated Better Auth config with credit fields in user.additionalFields.
</objective>

<execution_context>
@/Users/ed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/01-database-foundation/01-VERIFICATION.md
@.planning/phases/01-database-foundation/01-01-SUMMARY.md

@apps/web/lib/better-auth/config.ts
@packages/database/src/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add credit fields to Better Auth additionalFields</name>
  <files>apps/web/lib/better-auth/config.ts</files>
  <action>
Update the Better Auth configuration to include freeCredits and freeChatMessages in user.additionalFields.

Add the following two fields to the `additionalFields` object inside the `user` configuration (after the existing `tosAcceptedAt` field, around line 139):

```typescript
// Free trial credit fields (default values match database schema)
freeCredits: {
  type: 'number',
  required: false,
  defaultValue: 10,
},
freeChatMessages: {
  type: 'number',
  required: false,
  defaultValue: 20,
},
```

Important notes:
- `required: false` allows existing users (who may have NULL values) to work correctly
- `defaultValue` matches the database schema defaults (10 credits, 20 chat messages)
- Field names use camelCase (freeCredits, freeChatMessages) which Better Auth maps to snake_case database columns (free_credits, free_chat_messages)
  </action>
  <verify>
Run TypeScript compilation and build to verify no type errors:
```bash
cd /Users/ed/Code/brag-ai && pnpm tsc --noEmit -p apps/web/tsconfig.json
cd /Users/ed/Code/brag-ai && pnpm build --filter=@bragdoc/web
```
  </verify>
  <done>
Better Auth config updated with:
- freeCredits in user.additionalFields with type: 'number', defaultValue: 10
- freeChatMessages in user.additionalFields with type: 'number', defaultValue: 20
- TypeScript compilation passes
- Web app builds successfully
  </done>
</task>

</tasks>

<verification>
All verification checks:

1. **TypeScript compiles:** `pnpm tsc --noEmit -p apps/web/tsconfig.json` passes
2. **Build passes:** `pnpm build --filter=@bragdoc/web` succeeds
3. **Config updated:** apps/web/lib/better-auth/config.ts contains freeCredits and freeChatMessages in additionalFields
4. **Values match schema:** defaultValue 10 for freeCredits, 20 for freeChatMessages (matches database schema)
</verification>

<success_criteria>
Gap closure plan 01-03 is complete when:

1. apps/web/lib/better-auth/config.ts contains freeCredits in user.additionalFields
2. apps/web/lib/better-auth/config.ts contains freeChatMessages in user.additionalFields
3. Both fields have correct types (number) and default values (10, 20)
4. TypeScript compilation passes
5. Web application builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/01-database-foundation/01-03-SUMMARY.md`
</output>
