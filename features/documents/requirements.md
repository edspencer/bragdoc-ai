# Document Management Feature Requirements

## Overview
Add CRUD interface for Document Management, allowing users to view, edit, and share documents generated by the chatbot (such as weekly reports and performance reviews). Documents can be shared via anonymous links for viewing by non-authenticated users.

## Database Schema
```typescript
document = pgTable(
  'Document',
  {
    id: uuid('id').notNull().defaultRandom(),
    createdAt: timestamp('createdAt').notNull(),
    updatedAt: timestamp('updated_at').notNull().defaultNow(),
    title: text('title').notNull(),
    content: text('content'),
    userId: uuid('userId')
      .notNull()
      .references(() => user.id),
    companyId: uuid('company_id').references(() => company.id),
    type: varchar('type', { length: 32 }), // weekly_report, performance_review, etc.
    shareToken: varchar('share_token', { length: 64 }), // null if not shared
  },
  (table) => {
    return {
      pk: primaryKey({ columns: [table.id, table.createdAt] }),
    };
  },
);
```

## Database Updates Needed
We need to add the following fields to the Document table to support sharing:
```typescript
shareToken: varchar('share_token', { length: 64 }), // null if not shared
type: varchar('type', { length: 32 }), // weekly_report, performance_review, etc.
updatedAt: timestamp('updated_at').notNull().defaultNow(),
```

## API Routes
- `GET /api/documents` - List all documents for current user
- `POST /api/documents` - Create a new document
- `GET /api/documents/[id]` - Get document details
- `PUT /api/documents/[id]` - Update document
- `DELETE /api/documents/[id]` - Delete document
- `POST /api/documents/[id]/share` - Generate share token
- `DELETE /api/documents/[id]/share` - Remove share token
- `GET /api/shared/[token]` - View shared document (public route)

## UI Components

### DocumentList
- Display documents in a table/grid with actions
- Sort by creation date and type
- Filter by document type and company
- Search by title
- Empty state for no documents
- Show document count badge in navigation

### DocumentForm
Form for editing documents with fields:
- Title (required)
- Content (required, rich text editor)
- Type (required: weekly_report, performance_review, etc.)
- Company (optional, select from user's companies)

### DocumentActions
- Edit button - Opens edit form
- Delete button - Shows confirmation dialog
- Share button - Generates/copies share link
- Unshare button - Removes share link

### DocumentViewer
- Rich text viewer for document content
- Shared view has simplified layout
- Print-friendly styling

## Page Layouts

### Documents List Page (/documents)
```
Documents
├── Search/Filter Bar
│   ├── Text Search
│   ├── Type Filter
│   └── Company Filter
├── Add Document Button (if manual creation allowed)
└── Document List
    ├── Document Row
    │   ├── Document Info
    │   │   ├── Title
    │   │   ├── Type
    │   │   ├── Company (if linked)
    │   │   └── Created Date
    │   └── Actions (Edit/Share/Delete)
    └── Empty State
```

### Document View/Edit Page (/documents/[id])
```
Document
├── Header
│   ├── Title
│   ├── Type Badge
│   ├── Company (if linked)
│   └── Actions (Share/Delete)
├── Content Editor
└── Save/Cancel Buttons
```

### Shared Document View (/shared/[token])
```
Document
├── Header
│   ├── Title
│   ├── Type Badge
│   └── Company Name (if linked)
└── Content Viewer
```

## Features
- Sort documents by creation date or type
- Filter by document type and company
- Search documents by title
- Rich text editing and viewing
- Share documents via anonymous links
- Print-friendly document views
- Document count badges in navigation
- Responsive design for mobile/desktop

## Technical Requirements
- Use Shadcn UI components
- Use ProseMirror for rich text editing
- Implement proper form validation
- Add loading states for async operations
- Handle API errors gracefully
- Support dark/light mode
- Follow existing code style and structure
- Secure sharing mechanism with revocable tokens
- Rate limiting on shared document views

## Future Enhancements
- Document templates
- Document versioning
- Export to PDF/Word
- Collaborative editing
- Document comments
- Advanced formatting options
- Document analytics (views, etc.)
- Bulk operations (delete, export)
- Integration with external storage
- Password protection for shared links
- Document expiration dates
